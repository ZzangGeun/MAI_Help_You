{% load static %}
{% load character_extras %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAI - {{ character_info.name|default:"캐릭터" }} 상세 정보</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/common.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/character.css' %}">
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="{% url 'main_page' %}" class="logo"> 
                <div class="logo-icon">MAI</div> 
                Maple Story Chatbot
            </a>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navigation">
        <div class="nav-content">
            <a href="{% url 'main_page' %}" class="nav-item">홈</a>
            <a href="{% url 'chatbot' %}" class="nav-item">CHAT BOT</a>
            <a href="{% url 'character_info' %}" class="nav-item active">캐릭터 검색</a>
            <a href="#" class="nav-item">큐브</a>
            <a href="#" class="nav-item">스타포스</a>
            <a href="#" class="nav-item">(API 연동)</a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container" style="justify-content: flex-start;">
        <main class="main-content" style="width: 100%;">
            {% if error %}
                <h1 class="main-title">오류 발생</h1>
                <p class="main-description" style="color: #e74c3c;">{{ error }}</p>
            {% elif character_info %}
            <div class="character-info-container">
                <!-- Left Profile Sidebar -->
                <aside class="character-profile-sidebar">
                    <div class="character-image-wrapper">
                        <img src="{{ character_info.image_url }}" alt="{{ character_info.name }} 이미지">
                    </div>
                    <h2 class="profile-name">{{ character_info.name }}</h2>
                    <p class="profile-details">{{ character_info.server }} | {{ character_info.job }}</p>
                    <div class="profile-stats">
                        <div class="profile-stat-item">
                            <span class="profile-stat-label">레벨</span>
                            <span class="profile-stat-value">Lv.{{ character_info.level }}</span>
                        </div>
                        <div class="profile-stat-item">
                            <span class="profile-stat-label">인기도</span>
                            <span class="profile-stat-value">{{ character_info.fame|default:"N/A" }}</span>
                        </div>
                    </div>
                </aside>

                <!-- Right Details Main -->
                <div class="character-details-main">
                    <div class="details-tabs">
                        <button class="tab-button active" onclick="openTab(event, 'stats')">주요 스탯</button>
                        <button class="tab-button" onclick="openTab(event, 'equipment')">장착 장비</button>
                        <button class="tab-button" onclick="openTab(event, 'skills')">스킬 정보</button>
                        <button class="tab-button" onclick="openTab(event, 'raw')">Raw 데이터</button>
                    </div>

                    <div id="stats" class="tab-content active">
                        <div class="info-card">
                            <h3 class="info-card-title">기본 스탯</h3>
                            <div class="stat-grid">
                                {% for key, value in character_info.stat_info.items %}
                                <div class="stat-item">
                                    <span class="stat-label">{{ key }}</span>
                                    <span class="stat-value">{{ value }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div id="equipment" class="tab-content">
                        <div class="info-card">
                            <h3 class="info-card-title">장비 목록</h3>
                            <div class="equipment-grid">
                                {% for item in character_info.item_info %}
                                <div class="equipment-item">
                                    <div class="equipment-icon"><img src="{{ item.item_icon }}" alt="{{ item.item_name }}"></div>
                                    <div class="equipment-name">{{ item.item_name }}</div>
                                    <div class="equipment-part">{{ item.item_part }}</div>
                                </div>
                                {% empty %}
                                <p>장착한 장비가 없습니다.</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div id="skills" class="tab-content">
                        <div class="info-card">
                            <h3 class="info-card-title">어빌리티</h3>
                            <pre class="raw-data-pre">{{ character_info.ability_info | pprint }}</pre>
                        </div>
                        <div class="info-card">
                            <h3 class="info-card-title">하이퍼스탯</h3>
                            <pre class="raw-data-pre">{{ character_info.hyper_stat_info | pprint }}</pre>
                        </div>
                    </div>

                    <div id="raw" class="tab-content">
                        <div class="info-card">
                            <h3 class="info-card-title">전체 데이터 (JSON)</h3>
                            <pre class="raw-data-pre">{{ character_info | pprint }}</pre>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
                <h1 class="main-title">캐릭터 정보</h1>
                <p class="main-description">{{ message|default:"캐릭터를 검색해주세요." }}</p>

                {% comment %}
                =============== 디자인 확인용 목업 데이터 ===============
                HTML 파일을 직접 열었을 때만 이 부분이 보입니다.
                서버 실행 시에는 무시됩니다.
                =====================================================
                <div class="character-info-container">
                    <!-- Left Profile Sidebar -->
                    <aside class="character-profile-sidebar">
                        <div class="character-image-wrapper">
                            <img src="https://via.placeholder.com/150" alt="캐릭터 이미지">
                        </div>
                        <h2 class="profile-name">디자인용캐릭</h2>
                        <p class="profile-details">스카니아 | 모험가</p>
                        <div class="profile-stats">
                            <div class="profile-stat-item">
                                <span class="profile-stat-label">레벨</span>
                                <span class="profile-stat-value">Lv.250</span>
                            </div>
                            <div class="profile-stat-item">
                                <span class="profile-stat-label">인기도</span>
                                <span class="profile-stat-value">12,345</span>
                            </div>
                        </div>
                    </aside>

                    <!-- Right Details Main -->
                    <div class="character-details-main">
                        <div class="details-tabs">
                            <button class="tab-button active" onclick="openTab(event, 'stats')">주요 스탯</button>
                            <button class="tab-button" onclick="openTab(event, 'equipment')">장착 장비</button>
                            <button class="tab-button" onclick="openTab(event, 'skills')">스킬 정보</button>
                            <button class="tab-button" onclick="openTab(event, 'raw')">Raw 데이터</button>
                        </div>

                        <div id="stats" class="tab-content active">
                            <div class="info-card">
                                <h3 class="info-card-title">기본 스탯</h3>
                                <div class="stat-grid">
                                    <div class="stat-item"><span class="stat-label">STR</span><span class="stat-value">10000</span></div>
                                    <div class="stat-item"><span class="stat-label">DEX</span><span class="stat-value">4000</span></div>
                                    <div class="stat-item"><span class="stat-label">공격력</span><span class="stat-value">5,000,000</span></div>
                                    <div class="stat-item"><span class="stat-label">보스 공격력</span><span class="stat-value">300%</span></div>
                                </div>
                            </div>
                        </div>

                        <div id="equipment" class="tab-content">
                            <div class="info-card">
                                <h3 class="info-card-title">장비 목록</h3>
                                <div class="equipment-grid">
                                    <div class="equipment-item">
                                        <div class="equipment-icon"><img src="https://via.placeholder.com/48" alt="장비 아이콘"></div>
                                        <div class="equipment-name">앱솔랩스 아머</div>
                                        <div class="equipment-part">상의</div>
                                    </div>
                                    <div class="equipment-item">
                                        <div class="equipment-icon"><img src="https://via.placeholder.com/48" alt="장비 아이콘"></div>
                                        <div class="equipment-name">파프니르 소드</div>
                                        <div class="equipment-part">무기</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="skills" class="tab-content">
                            <div class="info-card">
                                <h3 class="info-card-title">어빌리티</h3>
                                <pre class="raw-data-pre">첫 줄: 보스 몬스터 공격 시 데미지 20% 증가</pre>
                            </div>
                        </div>

                        <div id="raw" class="tab-content">
                            <div class="info-card">
                                <h3 class="info-card-title">전체 데이터 (JSON)</h3>
                                <pre class="raw-data-pre">{ "message": "Raw 데이터 예시입니다." }</pre>
                            </div>
                        </div>
                    </div>
                </div>
                {% endcomment %}
            {% endif %}
        </main>
    </div>

    <script src="{% static 'js/common.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            MapleStoryChatBot.setActiveNavItem('캐릭터 검색');
        });

        function openTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>